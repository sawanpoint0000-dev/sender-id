<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Admin User System</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{background:#eef2f5;font-family:Arial}
.box{
 max-width:420px;margin:20px auto;background:#fff;
 padding:20px;border-radius:10px;
 box-shadow:0 0 12px rgba(0,0,0,.15)
}
h2,h3{text-align:center}
input,textarea,button{
 width:100%;padding:10px;margin-top:10px
}
button{
 background:#007bff;color:#fff;border:none;
 border-radius:6px;cursor:pointer
}
.row{display:flex;gap:6px}
.hide{display:none}
.msg{
 background:#f1f1f1;padding:10px;margin-top:10px;border-radius:6px
}
.copy{background:#28a745}
input[readonly]{background:#f5f5f5}
pre{white-space:pre-wrap}
</style>
</head>

<body>

<!-- ROLE SELECT -->
<div class="box" id="roleBox">
 <h2>Select Login</h2>
 <button onclick="showAdminLogin()">Admin Login</button>
 <button onclick="showUserLogin()">User Login</button>
</div>

<!-- ADMIN LOGIN -->
<div class="box hide" id="adminLoginBox">
 <h2>Admin Login</h2>
 <input id="adminEmail" placeholder="Admin Email">
 <input id="adminPass" type="password" placeholder="Password">
 <button onclick="adminLogin()">Login</button>
</div>

<!-- USER LOGIN -->
<div class="box hide" id="userLoginBox">
 <h2>User Login</h2>
 <input id="userEmail" placeholder="Email">
 <input id="userPass" type="password" placeholder="Password">
 <button onclick="userLogin()">Login</button>
</div>

<!-- USER PANEL -->
<div class="box hide" id="userPanel">
 <h2>ID Generator</h2>

 <input id="email" placeholder="Enter Email">
 <input id="mobile" placeholder="Enter Mobile">

 <button onclick="generate()">Generate</button>

 <div class="row">
  <input id="userid" readonly placeholder="User ID">
  <button class="copy" onclick="copyOne('userid')">Copy</button>
 </div>

 <div class="row">
  <input id="pass" readonly placeholder="Password">
  <button class="copy" onclick="copyOne('pass')">Copy</button>
 </div>

 <div class="row">
  <input id="phone" readonly placeholder="Mobile">
  <button class="copy" onclick="copyOne('phone')">Copy</button>
 </div>

 <div class="row">
  <input id="mailout" readonly placeholder="Email">
  <button class="copy" onclick="copyOne('mailout')">Copy</button>
 </div>

 <button onclick="sendAndCopy()">ALL COPY</button>
</div>

<!-- ADMIN PANEL -->
<div class="box hide" id="adminPanel">
 <h3>User Messages</h3>
 <div id="adminMsgs"></div>
</div>

<!-- FIREBASE -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
firebase.initializeApp({
 apiKey:"AIzaSyCTli8-1fuDNFAVdb9DNpmlLI0KalOEkGw",
 authDomain:"idgenerator-cd866.firebaseapp.com",
 databaseURL:"https://idgenerator-cd866-default-rtdb.firebaseio.com",
 projectId:"idgenerator-cd866"
});


function generateUserNameFromEmail(email){
  // first name from email
  let name = email.split("@")[0]
    .replace(/[^a-zA-Z]/g,"")
    .toLowerCase();

  // 1–2 digits
  const digits = Math.floor(10 + Math.random() * 90)
    .toString()
    .slice(0, Math.random() > 0.5 ? 2 : 1);

  // 3–4 small letters
  const letters = "abcdefghijklmnopqrstuvwxyz";
  let tail = "";
  const len = Math.random() > 0.5 ? 4 : 3;
  for(let i=0;i<len;i++){
    tail += letters[Math.floor(Math.random()*letters.length)];
  }

  return name + digits + tail;
}

const auth = firebase.auth();
const db = firebase.database();

/* ---------- UI SWITCH ---------- */
function showAdminLogin(){
 roleBox.classList.add("hide");
 adminLoginBox.classList.remove("hide");
}

function showUserLogin(){
 roleBox.classList.add("hide");
 userLoginBox.classList.remove("hide");
}

/* ---------- LOGIN ---------- */
function adminLogin(){
 auth.signInWithEmailAndPassword(
  adminEmail.value.trim(),
  adminPass.value.trim()
 ).then(()=>{
  adminLoginBox.classList.add("hide");
  adminPanel.classList.remove("hide");
  loadAdmin();
 }).catch(e=>alert(e.message));
}

function userLogin(){
 auth.signInWithEmailAndPassword(
  userEmail.value.trim(),
  userPass.value.trim()
 ).then(()=>{
  userLoginBox.classList.add("hide");
  userPanel.classList.remove("hide");
 }).catch(e=>alert(e.message));
}

/* ---------- GENERATE ---------- */
function randomPassword(){
 const c="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789@#$%&*!";
 let p="";
 for(let i=0;i<12;i++){
  p+=c[Math.floor(Math.random()*c.length)];
 }
 return p;
}

function generate(){
 if(!email.value || !mobile.value) return;

 const base=email.value.split("@")[0]
  .replace(/[^a-zA-Z]/g,"")
  .toLowerCase();

 userid.value = generateUserNameFromEmail(email.value);
 pass.value = randomPassword();
 phone.value = mobile.value;
 mailout.value = email.value;
}

/* ---------- COPY ---------- */
function copyOne(id){
 const v=document.getElementById(id).value;
 if(v) navigator.clipboard.writeText(v);
}

/* ---------- SEND + COPY ---------- */
function sendAndCopy(){
 if(!userid.value || !pass.value || !phone.value || !mailout.value) return;

 const u = auth.currentUser;
 if(!u) return;

 const copyText =
`${userid.value}
${pass.value}
${phone.value}
${mailout.value}`;

 navigator.clipboard.writeText(copyText);

 db.ref("messages").push({
  sender: u.email,
  userid: userid.value,
  password: pass.value,
  mobile: phone.value,
  email: mailout.value,
  time: Date.now()
 });
}

/* ---------- ADMIN VIEW ---------- */
function loadAdmin(){
 adminMsgs.innerHTML="";
 db.ref("messages").on("child_added",s=>{
  const d=s.val();

  const show =
`Sender: ${d.sender}
-------------------------
ID: ${d.userid}
PASS: ${d.password}
MOBILE: ${d.mobile}
EMAIL: ${d.email}`;

  const copy =
`${d.userid}
${d.password}
${d.mobile}
${d.email}`;

  adminMsgs.innerHTML += `
   <div class="msg">
    <pre>${show}</pre>
    <button class="copy"
     onclick="navigator.clipboard.writeText(\`${copy}\`)">
     COPY
    </button>
   </div>`;
 });
}
</script>
</body>
</html>
